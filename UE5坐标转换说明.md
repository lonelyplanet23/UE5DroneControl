# UE5 无人机坐标转换说明

## 📐 坐标系对比

### 无人机坐标系（NED）
- **X 轴**：North（北方，米）
- **Y 轴**：East（东方，米）
- **Z 轴**：Down（向下，米）- **向下为正值**
- **原点**：无人机的初始起飞位置

### UE5 坐标系（左手系）
- **X 轴**：Forward（前方，厘米）
- **Y 轴**：Right（右方，厘米）
- **Z 轴**：Up（向上，厘米）- **向上为正值**
- **原点**：RealTimeDroneReceiver Actor 的初始位置

---

## 🔄 转换规则

### 1. 轴向映射
```cpp
UE5_X = NED_X     // North → Forward
UE5_Y = NED_Y     // East → Right
UE5_Z = -NED_Z    // Down → Up (取负号，因为方向相反)
```

### 2. 单位转换
```cpp
厘米 = 米 × 100
```

### 3. 原点设置
```cpp
世界坐标 = 初始位置 + 相对偏移
NewTarget = InitialLocation + NEDOffset
```

---

## ✅ 完整转换公式

```cpp
// 输入：NED 坐标（米）
FVector NEDPos(north, east, down);

// 步骤1：轴向转换 + 单位转换
FVector UE5Offset(
    NEDPos.X * 100.0f,      // North → X (米→厘米)
    NEDPos.Y * 100.0f,      // East  → Y (米→厘米)
    -NEDPos.Z * 100.0f      // -Down → Up (米→厘米，取负)
);

// 步骤2：应用缩放因子（可选）
UE5Offset *= ScaleFactor;  // 默认 1.0

// 步骤3：加上初始位置
FVector WorldPos = InitialLocation + UE5Offset;
```

---

## 📝 示例

### 例1：无人机向北移动 5 米

```
无人机 NED 位置: (5.0, 0.0, 0.0) 米
                    ↓ 转换
UE5 偏移量:      (500, 0, 0) 厘米
                    ↓ 加上初始位置
假设初始位置:    (1000, 2000, 150) 厘米
最终世界坐标:    (1500, 2000, 150) 厘米
```

### 例2：无人机向上飞 2 米

```
无人机 NED 位置: (0.0, 0.0, -2.0) 米  ← 注意：向上是负的Down
                    ↓ 转换
UE5 偏移量:      (0, 0, 200) 厘米    ← -(-2.0) * 100 = 200
                    ↓ 加上初始位置
假设初始位置:    (1000, 2000, 150) 厘米
最终世界坐标:    (1000, 2000, 350) 厘米
```

### 例3：无人机向东南方移动并上升

```
无人机 NED 位置: (3.0, 4.0, -1.5) 米
                    ↓ 转换
UE5 偏移量:      (300, 400, 150) 厘米
                    ↓ 加上初始位置
假设初始位置:    (1000, 2000, 150) 厘米
最终世界坐标:    (1300, 2400, 300) 厘米
```

---

## ⚠️ 重要注意事项

### 1. 地图方向对齐
**假设**：你的 UE5 地图的 **+X 轴指向北方**

如果不是，需要额外旋转。例如：
- 如果地图 +Y 指向北方，需要旋转 90°
- 如果地图 -X 指向北方，需要旋转 180°

### 2. 初始位置的重要性
`InitialLocation` 在 `BeginPlay()` 时记录：
```cpp
InitialLocation = GetActorLocation();
```

这意味着：
- **无人机的 (0,0,0) = RealTimeDroneReceiver Actor 的初始位置**
- 你可以把 Actor 放在地图的任意位置
- 无人机的运动是相对这个位置的

### 3. Z 轴方向
- **NED 的 Down**：向下为正（海拔降低 = +Z）
- **UE5 的 Up**：向上为正（高度增加 = +Z）
- **转换时取负号**：`-NEDPos.Z`

---

## 🧪 测试建议

当无人机有真实位置数据时，在 Output Log 查看：

```
>>> [ProcessPacket] 解析成功! NED Position=(3.50, 2.10, -1.20) [米]
>>> [ProcessPacket] UE5 偏移量=(350.00, 210.00, 120.00) [厘米]
>>> [ProcessPacket] 初始位置=(1000.00, 2000.00, 150.00), 目标位置=(1350.00, 2210.00, 270.00)
```

检查：
1. NED 位置是否合理？
2. 偏移量计算是否正确？
3. 目标位置是否在预期范围？

---

## 🎯 配置参数

在 UE5 的 Details 面板可以调整：

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `ScaleFactor` | 缩放因子 | 1.0 |
| `SmoothSpeed` | 平滑移动速度 | 5.0 |
| `bUseReceivedRotation` | 使用接收的旋转 | true |
| `bAutoFaceTarget` | 自动朝向移动方向 | true |

---

生成时间：2026-01-25
